<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 27.2.

Copyright (C) 1990-1996, 1998-2021 Free Software Foundation,
Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License," with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual.  Buying copies from the FSF supports it in
developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rev="made" href="mailto:bug-gnu-emacs@gnu.org">
<link rel="icon" type="image/png" href="/graphics/gnu-head-mini.png">
<meta name="ICBM" content="42.256233,-71.006581">
<meta name="DC.title" content="gnu.org">

<style type="text/css">
@import url('/software/emacs/manual.css');
</style>
</head>

<body lang="en">
<span id="Core-Advising-Primitives"></span><div class="header" style="background-color:#DDDDFF">
<p>
Next: <a href="Advising-Named-Functions.html" accesskey="n" rel="next">Advising Named Functions</a>, Up: <a href="Advising-Functions.html" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>

<span id="Primitives-to-manipulate-advices"></span><h4 class="subsection">13.11.1 Primitives to manipulate advices</h4>
<span id="index-advice_002c-add-and-remove"></span>

<dl>
<dt id="index-add_002dfunction">Macro: <strong>add-function</strong> <em>where place function &amp;optional props</em></dt>
<dd><p>This macro is the handy way to add the advice <var>function</var> to the function
stored in <var>place</var> (see <a href="Generalized-Variables.html">Generalized Variables</a>).
</p>
<p><var>where</var> determines how <var>function</var> is composed with the
existing function, e.g., whether <var>function</var> should be called before, or
after the original function.  See <a href="Advice-Combinators.html">Advice Combinators</a>, for the list of
available ways to compose the two functions.
</p>
<p>When modifying a variable (whose name will usually end with <code>-function</code>),
you can choose whether <var>function</var> is used globally or only in the current
buffer: if <var>place</var> is just a symbol, then <var>function</var> is added to the
global value of <var>place</var>.  Whereas if <var>place</var> is of the form
<code>(local <var>symbol</var>)</code>, where <var>symbol</var> is an expression which returns
the variable name, then <var>function</var> will only be added in the
current buffer.  Finally, if you want to modify a lexical variable, you will
have to use <code>(var <var>variable</var>)</code>.
</p>
<p>Every function added with <code>add-function</code> can be accompanied by an
association list of properties <var>props</var>.  Currently only two of those
properties have a special meaning:
</p>
<dl compact="compact">
<dt><code>name</code></dt>
<dd><p>This gives a name to the advice, which <code>remove-function</code> can use to
identify which function to remove.  Typically used when <var>function</var> is an
anonymous function.
</p>
</dd>
<dt><code>depth</code></dt>
<dd><p>This specifies how to order the advice, should several pieces of
advice be present.  By default, the depth is 0.  A depth of 100
indicates that this piece of advice should be kept as deep as
possible, whereas a depth of -100 indicates that it should stay as the
outermost piece.  When two pieces of advice specify the same depth,
the most recently added one will be outermost.
</p>
<p>For <code>:before</code> advice, being outermost means that this advice will
be run first, before any other advice, whereas being innermost means
that it will run right before the original function, with no other
advice run between itself and the original function.  Similarly, for
<code>:after</code> advice innermost means that it will run right after the
original function, with no other advice run in between, whereas
outermost means that it will be run right at the end after all other
advice.  An innermost <code>:override</code> piece of advice will only
override the original function and other pieces of advice will apply
to it, whereas an outermost <code>:override</code> piece of advice will
override not only the original function but all other advice applied
to it as well.
</p></dd>
</dl>

<p>If <var>function</var> is not interactive, then the combined function will inherit
the interactive spec, if any, of the original function.  Else, the combined
function will be interactive and will use the interactive spec of
<var>function</var>.  One exception: if the interactive spec of <var>function</var>
is a function (i.e., a <code>lambda</code> expression or an <code>fbound</code>
symbol rather than an expression or a string), then the interactive
spec of the combined function will be a call to that function with as sole
argument the interactive spec of the original function.  To interpret the spec
received as argument, use <code>advice-eval-interactive-spec</code>.
</p>
<p>Note: The interactive spec of <var>function</var> will apply to the combined
function and should hence obey the calling convention of the combined function
rather than that of <var>function</var>.  In many cases, it makes no difference
since they are identical, but it does matter for <code>:around</code>,
<code>:filter-args</code>, and <code>:filter-return</code>, where <var>function</var>
receives different arguments than the original function stored in
<var>place</var>.
</p></dd></dl>

<dl>
<dt id="index-remove_002dfunction">Macro: <strong>remove-function</strong> <em>place function</em></dt>
<dd><p>This macro removes <var>function</var> from the function stored in
<var>place</var>.  This only works if <var>function</var> was added to <var>place</var>
using <code>add-function</code>.
</p>
<p><var>function</var> is compared with functions added to <var>place</var> using
<code>equal</code>, to try and make it work also with lambda expressions.  It is
additionally compared also with the <code>name</code> property of the functions added
to <var>place</var>, which can be more reliable than comparing lambda expressions
using <code>equal</code>.
</p></dd></dl>

<dl>
<dt id="index-advice_002dfunction_002dmember_002dp">Function: <strong>advice-function-member-p</strong> <em>advice function-def</em></dt>
<dd><p>Return non-<code>nil</code> if <var>advice</var> is already in <var>function-def</var>.
Like for <code>remove-function</code> above, instead of <var>advice</var> being the actual
function, it can also be the <code>name</code> of the piece of advice.
</p></dd></dl>

<dl>
<dt id="index-advice_002dfunction_002dmapc">Function: <strong>advice-function-mapc</strong> <em>f function-def</em></dt>
<dd><p>Call the function <var>f</var> for every piece of advice that was added to
<var>function-def</var>.  <var>f</var> is called with two arguments: the advice function
and its properties.
</p></dd></dl>

<dl>
<dt id="index-advice_002deval_002dinteractive_002dspec">Function: <strong>advice-eval-interactive-spec</strong> <em>spec</em></dt>
<dd><p>Evaluate the interactive <var>spec</var> just like an interactive call to a function
with such a spec would, and then return the corresponding list of arguments
that was built.  E.g., <code>(advice-eval-interactive-spec &quot;r\nP&quot;)</code> will
return a list of three elements, containing the boundaries of the region and
the current prefix argument.
</p>
<p>For instance, if you want to make the <kbd>C-x m</kbd>
(<code>compose-mail</code>) command prompt for a &lsquo;<samp>From:</samp>&rsquo; header, you
could say something like this:
</p>
<div class="example">
<pre class="example">(defun my-compose-mail-advice (orig &amp;rest args)
  &quot;Read From: address interactively.&quot;
  (interactive
   (lambda (spec)
     (let* ((user-mail-address
             (completing-read &quot;From: &quot;
                              '(&quot;one.address@example.net&quot;
                                &quot;alternative.address@example.net&quot;)))
            (from (message-make-from user-full-name
                                     user-mail-address))
            (spec (advice-eval-interactive-spec spec)))
       ;; Put the From header into the OTHER-HEADERS argument.
       (push (cons 'From from) (nth 2 spec))
       spec)))
  (apply orig args))

(advice-add 'compose-mail :around #'my-compose-mail-advice)
</pre></div>
</dd></dl>


<div class="header" style="background-color:#DDDDFF">
<p>
Next: <a href="Advising-Named-Functions.html" accesskey="n" rel="next">Advising Named Functions</a>, Up: <a href="Advising-Functions.html" accesskey="u" rel="up">Advising Functions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
